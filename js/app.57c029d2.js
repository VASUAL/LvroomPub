(function(e){function t(t){for(var i,o,r=t[0],l=t[1],c=t[2],m=0,d=[];m<r.length;m++)o=r[m],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&d.push(n[o][0]),n[o]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);u&&u(t);while(d.length)d.shift()();return s.push.apply(s,c||[]),a()}function a(){for(var e,t=0;t<s.length;t++){for(var a=s[t],i=!0,r=1;r<a.length;r++){var l=a[r];0!==n[l]&&(i=!1)}i&&(s.splice(t--,1),e=o(o.s=a[0]))}return e}var i={},n={app:0},s=[];function o(t){if(i[t])return i[t].exports;var a=i[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=i,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(a,i,function(t){return e[t]}.bind(null,i));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var u=l;s.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";a("85ec")},"0abd":function(e,t,a){},"15d1":function(e,t,a){"use strict";a("bcf1")},3785:function(e,t){},"454e":function(e,t,a){},"4e25":function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);a("0fae");var i,n,s=a("9e2f"),o=a.n(s),r=(a("e260"),a("e6cf"),a("cca6"),a("a79d"),a("2b0e")),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"app",attrs:{id:"app"}},[a("router-view")],1)},c=[],u=(a("034f"),a("2877")),m={},d=Object(u["a"])(m,l,c,!1,null,null,null),p=d.exports,f=a("8c4f"),h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-main",[a("el-form",{ref:"loginForm",staticClass:"login-box",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[a("h3",{staticClass:"login-title"},[e._v("弱电间管理系统")]),a("el-form-item",{attrs:{label:"账号",prop:"username"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入账号"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{type:"password",placeholder:"请输入密码"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),a("el-form-item",[a("el-button",{staticStyle:{width:"80%"},attrs:{disabled:e.disabled,type:"primary"},on:{click:function(t){return e.onSubmit()}}},[e._v("登录")])],1)],1)],1)},g=[],b={name:"Login",mounted:function(){localStorage.getItem("token")&&this.$router.push("/display")},data:function(){return{disabled:!1,form:{username:"",password:""},rules:{username:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}}},methods:{onSubmit:function(){var e=this;this.$refs["loginForm"].validate((function(t){if(!t)return!1;e.disabled=!0,e.API.login(e.form.username,e.form.password).then((function(t){localStorage.user_id=t.user_id,localStorage.username=t.username,localStorage.realname=t.realname,localStorage.character=t.character,localStorage.token=t.token,e.$notify({title:"登录成功",message:"欢迎你 ".concat(t.realname),type:"success",duration:1e3,onClose:function(){e.$router.push("/display")}})})).catch((function(){e.disabled=!1}))}))}}},v=b,_=(a("9269"),Object(u["a"])(v,h,g,!1,null,"73fecec6",null)),y=_.exports,w=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-container",[a("el-header",[a("el-menu",{staticClass:"menu",attrs:{mode:"horizontal",router:!0,"default-active":e.defaultActive}},[a("h4",[e._v("弱电间管理系统")]),a("div",{staticClass:"header-right"},[a("el-submenu",{attrs:{index:"#"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-s-custom"}),e._v(e._s(e.realname)+"    ")]),a("el-menu-item",{attrs:{index:"#logout"},on:{click:e.logout}},[e._v("登出")])],2)],1)])],1),a("el-main",{style:e.defaultHeight},[a("div",[a("div",{attrs:{id:"mission-list"}},[a("el-tabs",{attrs:{type:"card"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("el-tab-pane",{attrs:{label:"未完成任务",name:"current"}}),a("el-tab-pane",{attrs:{label:"暂存任务",name:"presave"}}),a("el-tab-pane",{attrs:{label:"历史任务",name:"history"}}),"current"===e.activeTab?a("mission-current",{ref:"current"}):e._e(),"presave"===e.activeTab?a("mission-presave",{ref:"presave"}):e._e(),"history"===e.activeTab?a("mission-history",{ref:"history"}):e._e()],1)],1)])]),a("el-footer",[a("el-row",[a("el-col",{attrs:{span:8}},[a("div",[a("el-button",{attrs:{icon:"el-icon-menu",circle:""},on:{click:e.display}}),a("div",[a("span",{staticStyle:{"font-size":"10px"}},[e._v("任务中心")])])],1)]),a("el-col",{attrs:{span:8}},[a("div",[a("el-button",{attrs:{icon:"el-icon-search",circle:""},on:{click:e.searchPosition}}),a("div",[a("span",{staticStyle:{"font-size":"10px"}},[e._v("查看地址")])])],1)]),a("el-col",{attrs:{span:8}},[a("div",[a("el-button",{attrs:{icon:"el-icon-user",circle:""},on:{click:e.personalCenter}}),a("div",[a("span",{staticStyle:{"font-size":"10px"}},[e._v("个人中心")])])],1)])],1)],1)],1)],1)},x=[],I=(a("d3b7"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:e.missionData,"default-sort":{prop:"deadline_t",order:"ascending"},stripe:"","max-height":"740"},on:{"selection-change":e.handleSelectionChange,"filter-change":e.filterChange,"sort-change":e.sortChange}},[a("el-table-column",{attrs:{width:"30"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.$index+1)+" ")]}}])}),a("el-table-column",{attrs:{prop:"type_name",label:"任务类型",width:"90","column-key":"typeIds",filters:e.filters.typeIds}}),a("el-table-column",{attrs:{prop:"campus_name",label:"校区",width:"75","column-key":"campusIds",filters:e.filters.campusIds}}),a("el-table-column",{attrs:{prop:"deadline_t",label:"截止时间",width:"105",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(new Date(1e3*t.row.deadline_t).toLocaleString())+" ")]}}])}),a("el-table-column",{attrs:{label:"操作",width:"73"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{disabled:(new Date).getTime()/1e3<t.row.start_t,type:"primary",size:"small"},on:{click:function(a){return e.$router.push("/submit/"+t.row.id)}}},[e._v("执行 ")])]}}])})],1)],1)}),S=[],$=(a("159b"),a("a15b"),a("b0c0"),{methods:{deleteMission:function(e){var t=this;this.$confirm("此操作将删除任务，是否继续？","删除任务",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.API.deleteMission(e.id).then((function(){t.getData(),t.$notify({title:"成功",message:"删除任务(ID: ".concat(e.id,")成功"),type:"success",duration:1e3})}))}))},cancelMission:function(e){var t=this;this.$confirm("此操作将取消任务，是否继续？","取消任务",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.API.cancelMission(e.id).then((function(){t.getData(),t.$notify({title:"成功",message:"取消任务(ID: ".concat(e.id,")成功"),type:"success",duration:1e3})}))}))},cancelMultiMissions:function(){var e=this;this.$confirm("此操作将取消 ".concat(this.multipleSelection.length," 个任务，是否继续？"),"取消任务",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.API.cancelMultiMissions(e.multipleSelection).then((function(){e.getData(),e.$refs["table"].clearSelection(),e.$notify({title:"成功",message:"取消任务成功",type:"success",duration:1e3})}))}))},getData:function(){var e=this;this.loading=!0,this.API.getMissionList(this.params).then((function(t){e.missionData=[],e.totalPage=t["total_page"],e.params.page>e.totalPage?e.params.page=e.totalPage:(e.missionData=t["results"],e.loading=!1)}))},handleSelectionChange:function(e){var t=this;this.multipleSelection=[],e.forEach((function(e){t.multipleSelection.push(e.id)}))},deleteMultiMissions:function(){var e=this;this.$confirm("此操作将删除 ".concat(this.multipleSelection.length," 个任务，是否继续？"),"删除任务",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.API.deleteMultiMissions(e.multipleSelection).then((function(){e.getData(),e.$refs["table"].clearSelection(),e.$notify({title:"成功",message:"删除任务成功",type:"success",duration:1e3})}))}))},filterChange:function(e){this.params.page=1,void 0!==e.campusIds&&(this.params.campus_ids=e.campusIds.join(",")),void 0!==e.typeIds&&(this.params.type_ids=e.typeIds.join(",")),void 0!==e.designaterIds&&(this.params.designater_ids=e.designaterIds.join(",")),void 0!==e.status&&(0===e.status.length?this.params.status="incomplete":this.params.status=e.status[0]),1===this.params.page?this.getData():this.params.page=1},sortChange:function(e){this.params.order_by=e.prop+"_"+e.order,1===this.params.page?this.getData():this.params.page=1},clearFilter:function(){this.$refs["table"].clearFilter(),this.params={page:1,page_size:30,campus_ids:null,type_ids:null,designater_ids:null,status:"incomplete",order_by:"deadline_t_ascending"},this.getData()}},mounted:function(){var e=this;this.getData(),this.API.getCampusList().then((function(t){e.filters.campusIds=[],t.forEach((function(t){e.filters.campusIds.push({text:t.name,value:t.id})}))})),this.API.getMissionTypes().then((function(t){e.filters.typeIds=[],t.forEach((function(t){e.filters.typeIds.push({text:t.name,value:t.id})}))})),this.API.getUserList().then((function(t){e.filters.userIds=[],t.forEach((function(t){e.filters.userIds.push({text:t.realname,value:t.id})}))}))},watch:{"params.page":function(){this.getData()}},data:function(){return{loading:!0,totalPage:1,missionData:[],multipleSelection:[],filters:{campusIds:[],typeIds:[],userIds:[],status:[{text:"未完成",value:"incomplete_intime"},{text:"超时未完成",value:"imcomplete_late"}]},params:{page:1,page_size:30,campus_ids:null,type_ids:null,designater_ids:null,status:"incomplete",order_by:"deadline_t_ascending"}}}}),P=$,T=(a("9736"),Object(u["a"])(P,I,S,!1,null,"5d27ab2e",null)),D=T.exports,C=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:e.missionData,"default-sort":{prop:"deadline_t",order:"ascending"},stripe:"","max-height":"580"},on:{"selection-change":e.handleSelectionChange,"filter-change":e.filterChange,"sort-change":e.sortChange}},[a("el-table-column",{attrs:{type:"index",width:"30"}}),a("el-table-column",{attrs:{prop:"type_name",label:"任务类型",width:"90","column-key":"typeIds",filters:e.filters.typeIds}}),a("el-table-column",{attrs:{prop:"campus_name",label:"校区",width:"75","column-key":"campusIds",filters:e.filters.campusIds}}),a("el-table-column",{attrs:{prop:"deadline_t",label:"截止时间",width:"105",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(new Date(1e3*t.row.deadline_t).toLocaleString())+" ")]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"73"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{disabled:(new Date).getTime()/1e3<t.row.start_t,type:"warning",size:"small"},on:{click:function(a){return e.$router.push("/submit/"+t.row.id)}}},[e._v("执行 ")])]}}])})],1)},E=[],k={methods:{getData:function(){var e=this;this.loading=!0,this.API.getMissionList(this.params).then((function(t){e.missionData=[],e.totalPage=t["total_page"],e.params.page>e.totalPage?e.params.page=e.totalPage:(e.missionData=t["results"],e.loading=!1)}))},filterChange:function(e){this.params.page=1,void 0!==e.campusIds&&(this.params.campus_ids=e.campusIds.join(",")),void 0!==e.typeIds&&(this.params.type_ids=e.typeIds.join(",")),void 0!==e.designaterIds&&(this.params.designater_ids=e.designaterIds.join(",")),void 0!==e.status&&(0===e.status.length?this.params.status="incomplete":this.params.status=e.status[0]),1===this.params.page?this.getData():this.params.page=1},sortChange:function(e){this.params.order_by=e.prop+"_"+e.order,1===this.params.page?this.getData():this.params.page=1},clearFilter:function(){this.$refs["table"].clearFilter(),this.params={page:1,page_size:30,campus_ids:null,type_ids:null,designater_ids:null,status:"incomplete",order_by:"deadline_t_ascending"},this.getData()}},mounted:function(){var e=this;this.getData(),this.API.getCampusList().then((function(t){e.filters.campusIds=[],t.forEach((function(t){e.filters.campusIds.push({text:t.name,value:t.id})}))})),this.API.getMissionTypes().then((function(t){e.filters.typeIds=[],t.forEach((function(t){e.filters.typeIds.push({text:t.name,value:t.id})}))})),this.API.getUserList().then((function(t){e.filters.userIds=[],t.forEach((function(t){e.filters.userIds.push({text:t.realname,value:t.id})}))}))},watch:{"params.page":function(){this.getData()}},data:function(){return{loading:!0,totalPage:1,missionData:[],multipleSelection:[],filters:{campusIds:[],typeIds:[],userIds:[],status:[{text:"未完成",value:"incomplete_intime"},{text:"超时未完成",value:"imcomplete_late"}]},params:{page:1,page_size:30,campus_ids:null,type_ids:null,designater_ids:null,status:"incomplete",order_by:"deadline_t_ascending",presave:1}}}},M=k,A=(a("15d1"),Object(u["a"])(M,C,E,!1,null,"1a33436e",null)),L=A.exports,j=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:e.missionData,"default-sort":{prop:"complete_t",order:"descending"},stripe:"","max-height":"740"},on:{"selection-change":e.handleSelectionChange,"filter-change":e.filterChange,"sort-change":e.sortChange}},[a("el-table-column",{attrs:{type:"index",width:"30"}}),a("el-table-column",{attrs:{prop:"type_name",label:"任务类型",width:"100","column-key":"typeIds",filters:e.filters.typeIds}}),a("el-table-column",{attrs:{prop:"complete_t",label:"完成时间",width:"150",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.complete_t?new Date(1e3*t.row.complete_t).toLocaleString():"无")+" ")]}}])}),a("el-table-column",{attrs:{label:"状态",width:"93","column-key":"status",filters:e.filters.status,"filter-multiple":!1},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.cancelled?a("el-tag",{attrs:{type:"warning",size:"medium"}},[e._v(" 已取消")]):t.row.deadline_t>t.row.complete_t?a("el-tag",{attrs:{type:"success",size:"medium"}},[e._v(" 按时完成")]):a("el-tag",{attrs:{type:"warning",size:"medium"}},[e._v(" 超时完成")])]}}])})],1)},R=[],O={methods:{deleteMission:function(e){var t=this;this.$confirm("此操作将删除任务，是否继续？","删除任务",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.API.deleteMission(e.id).then((function(){t.getData(),t.$notify({title:"成功",message:"删除任务(ID: ".concat(e.id,")成功"),type:"success",duration:1e3})}))}))},restartMission:function(e){var t=this;this.$confirm("此操作将重启任务，是否继续？","重启任务",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.API.restartMission(e.id).then((function(){t.getData(),t.$notify({title:"成功",message:"重启任务(ID: ".concat(e.id,")成功"),type:"success",duration:1e3})}))}))},showRecord:function(e){var t=this;this.API.getMissionRecord(e.id).then((function(e){t.room=e.room,t.mission=e.mission,t.record=e.record,t.recordVisible=!0}))},getData:function(){var e=this;this.loading=!0,this.API.getMissionList(this.params).then((function(t){e.missionData=[],e.totalPage=t["total_page"],e.params.page>e.totalPage?e.params.page=e.totalPage:(e.missionData=t["results"],e.loading=!1)}))},handleSelectionChange:function(e){var t=this;this.multipleSelection=[],e.forEach((function(e){t.multipleSelection.push(e.id)}))},deleteMultiMissions:function(){var e=this;this.$confirm("此操作将删除 ".concat(this.multipleSelection.length," 个任务，是否继续？"),"删除任务",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.API.deleteMultiMissions(e.multipleSelection).then((function(){e.getData(),e.$refs["table"].clearSelection(),e.$notify({title:"成功",message:"删除任务成功",type:"success",duration:1e3})}))}))},restartMultiMissions:function(){var e=this;this.$confirm("此操作将重启 ".concat(this.multipleSelection.length," 个任务，是否继续？"),"删除任务",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.API.restartMultiMissions(e.multipleSelection).then((function(){e.getData(),e.$refs["table"].clearSelection(),e.$notify({title:"成功",message:"重启任务成功",type:"success",duration:1e3})}))}))},filterChange:function(e){this.params.page=1,void 0!==e.campusIds&&(this.params.campus_ids=e.campusIds.join(",")),void 0!==e.typeIds&&(this.params.type_ids=e.typeIds.join(",")),void 0!==e.designaterIds&&(this.params.designater_ids=e.designaterIds.join(",")),void 0!==e.executorIds&&(this.params.executor_ids=e.executorIds.join(",")),void 0!==e.status&&(0===e.status.length?this.params.status="complete":this.params.status=e.status[0]),1===this.params.page?this.getData():this.params.page=1},sortChange:function(e){this.params.order_by=e.prop+"_"+e.order,1===this.params.page?this.getData():this.params.page=1},clearFilter:function(){this.$refs["table"].clearFilter(),this.params={page:1,page_size:30,campus_ids:null,type_ids:null,designater_ids:null,executor_ids:null,status:"complete",order_by:"complete_t_descending"},this.getData()}},mounted:function(){var e=this;this.getData(),this.API.getCampusList().then((function(t){e.filters.campusIds=[],t.forEach((function(t){e.filters.campusIds.push({text:t.name,value:t.id})}))})),this.API.getMissionTypes().then((function(t){e.filters.typeIds=[],t.forEach((function(t){e.filters.typeIds.push({text:t.name,value:t.id})}))})),this.API.getUserList().then((function(t){e.filters.userIds=[],t.forEach((function(t){e.filters.userIds.push({text:t.realname,value:t.id})}))}))},watch:{"params.page":function(){this.getData()}},data:function(){return{loading:!0,room:{id:null,number:null,location:null,campus:{id:null,name:null},building:{id:null,number:null,name:null}},mission:{designater_name:null,executor_name:null,complete_t:null,type_name:""},record:{clean:null,cable:null,air:null,before_images:[],after_images:[],description:"",problem:""},recordVisible:!1,totalPage:1,missionData:[],multipleSelection:[],filters:{campusIds:[],typeIds:[],userIds:[],status:[{text:"按时完成",value:"complete_intime"},{text:"超时完成",value:"complete_late"},{text:"已取消",value:"cancelled"}]},params:{page:1,page_size:30,campus_ids:null,type_ids:null,designater_ids:null,executor_ids:null,status:"complete",order_by:"complete_t_descending"}}}},U=O,z=(a("6cb2"),Object(u["a"])(U,j,R,!1,null,"f8b4b1c6",null)),B=z.exports,G={components:{MissionCurrent:D,MissionPresave:L,MissionHistory:B},methods:{missionCreated:function(){this.activeTab="current",this.$refs["current"].currentPage=1,this.$refs["current"].getData()},exportMissions:function(){var e=this;this.exportLoading=!0,this.API.exportMissions(parseInt(this.exportDate[0].getTime()/1e3),parseInt(this.exportDate[1].getTime()/1e3)+86400).then((function(t){e.exportNum=t["count"],e.exportUrl=e.STATIC_URL+t["filename"]})).finally((function(){e.exportLoading=!1}))},logout:function(){var e=this;this.$notify({title:"登出成功",message:"您已登出，请重新登录",type:"success",duration:1e3,onClose:function(){localStorage.clear(),e.$router.push("/")}})},getHeight:function(){this.defaultHeight.height=window.innerHeight-120+"px"},display:function(){this.$router.push("/display")},searchPosition:function(){this.$router.push("/searchPosition")},personalCenter:function(){this.$router.push("/personalCenter/".concat(localStorage.user_id))}},created:function(){window.addEventListener("resize",this.getHeight()),this.getHeight()},data:function(){return{defaultHeight:{height:""},user_id:localStorage.getItem("user_id"),realname:localStorage.getItem("realname"),activeTab:"current",exportVisible:!1,exportLoading:!1,exportDate:[new Date((new Date).getTime()-2592e6),new Date],exportUrl:"",exportNum:0}}},H=G,V=(a("8818"),Object(u["a"])(H,w,x,!1,null,"728c5a3e",null)),F=V.exports,N=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-main",{staticClass:"main"},[a("el-card",[a("div",{attrs:{slot:"header"},slot:"header"},[a("el-page-header",{attrs:{content:"提交任务"},on:{back:function(t){return e.$router.go(-1)}}})],1),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.flags.loading,expression:"flags.loading"}],staticClass:"detail-main"},[e.room.building.id?a("room-detail",{attrs:{title:"弱电间信息",info:e.room}}):e._e(),a("h4",{attrs:{align:"left"}},[e._v("任务记录")]),a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"完成人员",prop:"realname"}},[a("el-input",{staticStyle:{width:"250px"},attrs:{readonly:""},model:{value:e.realname,callback:function(t){e.realname=t},expression:"realname"}})],1),a("el-form-item",{attrs:{label:"完成时间",prop:"complete_t"}},[a("el-date-picker",{staticStyle:{width:"250px"},attrs:{readonly:"",type:"datetime",placeholder:"选择日期时间"},model:{value:e.mission.complete_t,callback:function(t){e.$set(e.mission,"complete_t",t)},expression:"mission.complete_t"}})],1),a("el-form-item",{attrs:{label:"任务类型",prop:"type_name"}},[a("el-input",{staticStyle:{width:"250px"},attrs:{readonly:""},model:{value:e.mission.type_name,callback:function(t){e.$set(e.mission,"type_name",t)},expression:"mission.type_name"}})],1),a("el-form-item",{attrs:{label:"任务说明"}},[e._v(" "+e._s(e.mission.description)+" ")]),a("el-form-item",{attrs:{label:"工作前照片",prop:"before_images"}},[a("el-upload",{attrs:{action:"#","on-preview":e.handlePreview,"before-remove":e.beforeRemove,"on-remove":function(t,a){e.form.before_images=a},"http-request":function(t){e.uploadImage(e.form.before_images,t)},"file-list":e.form.before_images,"list-type":"picture-card",accept:"image/*"}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击拍摄")]),a("div",{attrs:{slot:"tip",align:"left"},slot:"tip"},[e._v("请依次拍摄到达位置照片，全貌照片，细节照片")])],1)],1),a("el-form-item",{attrs:{label:"卫生情况",prop:"clean"}},[a("el-radio-group",{model:{value:e.form.clean,callback:function(t){e.$set(e.form,"clean",t)},expression:"form.clean"}},[a("el-radio",{attrs:{label:1}},[e._v("A")]),a("el-radio",{attrs:{label:2}},[e._v("B")]),a("el-radio",{attrs:{label:3}},[e._v("C")]),a("el-radio",{attrs:{label:0}},[e._v("无")])],1)],1),a("el-form-item",{attrs:{label:"线缆情况",prop:"cable"}},[a("el-radio-group",{model:{value:e.form.cable,callback:function(t){e.$set(e.form,"cable",t)},expression:"form.cable"}},[a("el-radio",{attrs:{label:1}},[e._v("A")]),a("el-radio",{attrs:{label:2}},[e._v("B")]),a("el-radio",{attrs:{label:3}},[e._v("C")]),a("el-radio",{attrs:{label:0}},[e._v("无")])],1)],1),a("el-form-item",{attrs:{label:"通风情况",prop:"air"}},[a("el-radio-group",{model:{value:e.form.air,callback:function(t){e.$set(e.form,"air",t)},expression:"form.air"}},[a("el-radio",{attrs:{label:1}},[e._v("A")]),a("el-radio",{attrs:{label:2}},[e._v("B")]),a("el-radio",{attrs:{label:3}},[e._v("C")]),a("el-radio",{attrs:{label:0}},[e._v("无")])],1)],1),a("el-form-item",{attrs:{label:"供电情况",prop:"power"}},[a("el-radio-group",{model:{value:e.form.power,callback:function(t){e.$set(e.form,"power",t)},expression:"form.power"}},[a("el-radio",{attrs:{label:1}},[e._v("A")]),a("el-radio",{attrs:{label:2}},[e._v("B")]),a("el-radio",{attrs:{label:3}},[e._v("C")]),a("el-radio",{attrs:{label:0}},[e._v("无")])],1)],1),a("el-form-item",{attrs:{label:"工作后照片",prop:"after_images"}},[a("el-upload",{attrs:{action:"#","on-preview":e.handlePreview,"before-remove":e.beforeRemove,"on-remove":function(t,a){e.form.after_images=a},"http-request":function(t){e.uploadImage(e.form.after_images,t)},"file-list":e.form.after_images,"list-type":"picture-card",accept:"image/*"}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击拍摄")]),a("div",{attrs:{slot:"tip",align:"left"},slot:"tip"},[e._v("只需拍摄细节照片")])],1)],1),a("el-form-item",{attrs:{label:"完成说明"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),a("el-form-item",{attrs:{label:"问题说明"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.problem,callback:function(t){e.$set(e.form,"problem",t)},expression:"form.problem"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",disabled:e.flags.disabled},on:{click:function(){e.flags.presave=!1,e.onSubmit()}}},[e._v("提交")]),a("el-button",{attrs:{type:"warning",disabled:e.flags.disabled},on:{click:function(){e.flags.presave=!0,e.onSubmit()}}},[e._v("暂存")]),a("el-button",{attrs:{disabled:e.flags.disabled},on:{click:function(t){return e.$router.go(-1)}}},[e._v("取消")])],1)],1)],1)]),a("el-dialog",{attrs:{visible:e.flags.confirmVisible,width:"80%"},on:{"update:visible":function(t){return e.$set(e.flags,"confirmVisible",t)}}},[a("mission-record",{attrs:{title:"提交确认",room:e.room,mission:e.mission,form:e.form}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.flags.confirmVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{disabled:e.flags.disabled,type:"primary"},on:{click:e.submitForm}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{visible:e.flags.previewVisible},on:{"update:visible":function(t){return e.$set(e.flags,"previewVisible",t)}}},[a("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},q=[],J=(a("5377"),a("a4d3"),a("e01a"),a("d81d"),a("b64b"),a("d9e2"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-descriptions",{attrs:{title:e.title,column:1,border:""}},[a("el-descriptions-item",{attrs:{label:"编号"}},[e._v(" "+e._s(e.info.number)+" ")]),a("el-descriptions-item",{attrs:{label:"校区"}},[e._v(" "+e._s(e.info.campus.name)+" ")]),a("el-descriptions-item",{attrs:{label:"楼号及名称",span:2}},[e._v(" "+e._s(e.info.building.number)+" "+e._s(e.info.building.name)+" ")]),a("el-descriptions-item",{attrs:{label:"类型",span:2}},[e._v(" "+e._s(e.info.type.name)+" ")]),a("el-descriptions-item",{attrs:{label:"具体位置",span:2}},[e._v(" "+e._s(e.info.location)+" ")]),a("el-descriptions-item",{attrs:{label:"门锁",span:2}},[e._v(" "+e._s(e.info.lock?"✅":"❌")+" ")]),a("el-descriptions-item",{attrs:{label:"空调",span:2}},[e._v(" "+e._s(e.info.ac?"✅":"❌")+" ")]),a("el-descriptions-item",{attrs:{label:"存在运营商设备"}},[e.info.mobile_device&&e.info.telecom_device&&e.info.unicom_device?[e._v(" ✅ ")]:e.info.mobile_device||e.info.telecom_device||e.info.unicom_device?[e._v(" ⭕ ")]:[e._v(" ❌ ")]],2),a("el-descriptions-item",{attrs:{label:"移动设备"}},[e._v(" "+e._s(e.info.mobile_device?"✅":"❌")+" ")]),a("el-descriptions-item",{attrs:{label:"电信设备",span:2}},[e._v(" "+e._s(e.info.telecom_device?"✅":"❌")+" ")]),a("el-descriptions-item",{attrs:{label:"联通设备",span:2}},[e._v(" "+e._s(e.info.unicom_device?"✅":"❌")+" ")]),a("el-descriptions-item",{attrs:{label:"卫生情况"}},[a("level-tag",{attrs:{data:e.info.clean}})],1),a("el-descriptions-item",{attrs:{label:"线缆情况"}},[a("level-tag",{attrs:{data:e.info.cable}})],1),a("el-descriptions-item",{attrs:{label:"通风情况",span:2}},[a("level-tag",{attrs:{data:e.info.air}})],1),a("el-descriptions-item",{attrs:{label:"电源情况",span:2}},[a("level-tag",{attrs:{data:e.info.power}})],1),void 0!==e.info.cam_ip?a("el-descriptions-item",{attrs:{label:"摄像头IP",span:3}},[e._v(" "+e._s(e.info.cam_ip||"无")+" ")]):e._e(),void 0!==e.info.cam_pwd?a("el-descriptions-item",{attrs:{label:"摄像头密码",span:3}},[e._v(" "+e._s(e.info.cam_pwd||"无")+" ")]):e._e()],1)}),X=[],Z={name:"LevelTag",props:["data"],data:function(){return{status_level:{null:"X",0:"X",1:"A",2:"B",3:"C"},status_type:{null:"info",0:"info",1:"success",2:"warning",3:"danger"}}}},K=Z,Q=a("3785"),W=a.n(Q),Y=Object(u["a"])(K,i,n,!1,null,null,null);"function"===typeof W.a&&W()(Y);var ee,te,ae=Y.exports,ie={components:{LevelTag:ae},props:["title","info"]},ne=ie,se=Object(u["a"])(ne,J,X,!1,null,null,null),oe=se.exports,re=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-descriptions",{staticClass:"margin-top",attrs:{title:e.title,column:4,border:""}},[a("el-descriptions-item",{attrs:{span:4}},[a("template",{slot:"label"},[e._v(" 弱电间地址 ")]),e._v(" "+e._s(e.room.campus.name)+" "+e._s(e.room.building.number)+" "+e._s(e.room.building.name)+" "+e._s(e.room.location)+" "+e._s(e.room.number)+" ")],2),a("el-descriptions-item",[a("template",{slot:"label"},[e._v(" 完成人员 ")]),e._v(" "+e._s(e.mission.executor_name)+" ")],2),a("el-descriptions-item",[a("template",{slot:"label"},[e._v(" 任务类型 ")]),e._v(" "+e._s(e.mission.type_name)+" ")],2),a("el-descriptions-item",{attrs:{span:2}},[a("template",{slot:"label"},[e._v(" 完成时间 ")]),e._v(" "+e._s("object"===typeof e.mission.complete_t?e.mission.complete_t.toLocaleString():new Date(1e3*e.mission.complete_t).toLocaleString())+" ")],2),a("el-descriptions-item",{attrs:{span:4}},[a("template",{slot:"label"},[e._v(" 任务说明 ")]),e._v(" "+e._s(e.mission.description||"无")+" ")],2),a("el-descriptions-item",[a("template",{slot:"label"},[e._v(" 卫生情况 ")]),a("level-tag",{attrs:{data:e.form.air}})],2),a("el-descriptions-item",[a("template",{slot:"label"},[e._v(" 线缆情况 ")]),a("level-tag",{attrs:{data:e.form.cable}})],2),a("el-descriptions-item",[a("template",{slot:"label"},[e._v(" 通风情况 ")]),a("level-tag",{attrs:{data:e.form.air}})],2),a("el-descriptions-item",[a("template",{slot:"label"},[e._v(" 电源情况 ")]),a("level-tag",{attrs:{data:e.form.power}})],2),a("el-descriptions-item",{attrs:{span:4}},[a("template",{slot:"label"},[e._v(" 工作前图片 ")]),a("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:0===e.imageBeforeList.length?"":e.imageBeforeList[0],"preview-src-list":e.imageBeforeList}},[a("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[0===e.imageBeforeList.length?a("span",[e._v("无图片")]):a("span",[e._v("加载失败")])])])],2),a("el-descriptions-item",{attrs:{span:4}},[a("template",{slot:"label"},[e._v(" 工作后图片 ")]),a("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:0===e.imageAfterList.length?"":e.imageAfterList[0],"preview-src-list":e.imageAfterList}},[a("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[0===e.imageAfterList.length?a("span",[e._v("无图片")]):a("span",[e._v("加载失败")])])])],2),a("el-descriptions-item",{attrs:{span:4}},[a("template",{slot:"label"},[e._v(" 完成说明 ")]),e._v(" "+e._s(e.form.description||"无")+" ")],2),a("el-descriptions-item",{attrs:{span:4}},[a("template",{slot:"label"},[e._v(" 问题说明 ")]),e._v(" "+e._s(e.form.problem||"无")+" ")],2)],1)},le=[],ce=a("53ca"),ue={components:{LevelTag:ae},props:["title","room","mission","form"],computed:{imageBeforeList:function(){var e=this,t=[];return this.form.before_images.forEach((function(a){"object"==Object(ce["a"])(a)?t.push(a.url):"http"!=a.substring(0,4)?t.push(e.axios.defaults.baseURL+"/static/"+a):t.push(a)})),t},imageAfterList:function(){var e=this,t=[];return this.form.after_images.forEach((function(a){"object"==Object(ce["a"])(a)?t.push(a.url):"http"!=a.substring(0,4)?t.push(e.axios.defaults.baseURL+"/static/"+a):t.push(a)})),t}}},me=ue,de=(a("d662"),Object(u["a"])(me,re,le,!1,null,null,null)),pe=de.exports,fe={components:{RoomDetail:oe,MissionRecord:pe},methods:{handlePreview:function(e){this.dialogImageUrl=e.url,this.flags.previewVisible=!0},beforeRemove:function(e){return this.$confirm("确定移除 ".concat(e.name,"？"))},uploadImage:function(e,t){this.API.uploadImage(t.file).then((function(a){t.onSuccess(),e.push(a)})).catch((function(){t.onError()}))},onSubmit:function(){var e=this;this.$refs["form"].validate((function(t){if(!t)return!1;e.flags.confirmVisible=!0}))},submitForm:function(){var e=this;this.flags.disabled=!0,this.API.submitMission(this.$router.currentRoute.params.id,this.flags.presave?1:0,{clean:this.form.clean,cable:this.form.cable,air:this.form.air,power:this.form.power,description:this.form.description,problem:this.form.problem,before_images:this.form.before_images.map((function(e){return e.name})),after_images:this.form.after_images.map((function(e){return e.name}))}).then((function(){e.$notify({title:"成功",message:"提交成功",type:"success",duration:1e3,onClose:function(){e.flags.disabled=!1,e.$router.push("/display")}})})).catch((function(){e.flags.confirmVisible=!1,e.flags.disabled=!1}))}},mounted:function(){var e=this;this.API.getMissionDetail(this.$router.currentRoute.params.id).then((function(t){t.presave&&(e.form.clean=t.clean,e.form.cable=t.cable,e.form.air=t.air,e.form.power=t.power,e.form.description=t.f_description,e.form.problem=t.f_problem,e.form.before_images=t.before_images.map((function(t){return{name:t,url:e.STATIC_URL+t}})),e.form.after_images=t.after_images.map((function(t){return{name:t,url:e.STATIC_URL+t}}))),null!==t.complete_t?e.$notify({title:"提示",message:"该任务已完成",type:"error",duration:1e3,onClose:function(){e.$router.push("/display")}}):(e.mission.designater_name=t.designater_name,e.mission.type_name=t.type_name,e.mission.description=t.description,e.API.getRoomDetail(t.room_id).then((function(t){Object.keys(e.room).forEach((function(a){void 0!==t[a]&&(e.room[a]=t[a])})),e.room.campus.id=t.campus_id,e.room.campus.name=t.campus_name,e.room.building.id=t.building_id,e.room.building.number=t.building_number,e.room.building.name=t.building_name,e.room.type.id=t.type_id,e.room.type.name=t.type_name,e.flags.loading=!1})))}))},data:function(){var e=function(e,t,a){0===t.length?a(new Error("请上传图片")):a()};return{realname:localStorage.getItem("realname"),flags:{loading:!0,disabled:!1,previewVisible:!1,confirmVisible:!1,presave:!1},dialogImageUrl:"",room:{id:null,number:null,campus:{id:null,name:null},building:{id:null,number:null,name:null},location:null,type:{id:null,name:null},lock:null,mobile_device:null,telecom_device:null,unicom_device:null,clean:0,cable:0,air:0,power:0},rules:{clean:[{required:!0,message:"请选择卫生情况",trigger:"change"}],cable:[{required:!0,message:"请选择线缆情况",trigger:"change"}],air:[{required:!0,message:"请选择通风情况",trigger:"change"}],power:[{required:!0,message:"请选择供电情况",trigger:"change"}],before_images:[{required:!0,validator:e,trigger:"change"}]},mission:{designater_name:null,executor_name:localStorage.getItem("realname"),complete_t:new Date,type_name:null,description:null},form:{clean:null,cable:null,air:null,power:null,before_images:[],after_images:[],description:"",problem:""}}}},he=fe,ge=(a("bbf1"),Object(u["a"])(he,N,q,!1,null,"37ca70cc",null)),be=ge.exports,ve=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-container",[a("el-header",[a("el-menu",{staticClass:"menu",attrs:{mode:"horizontal",router:!0,"default-active":e.defaultActive}},[a("h4",[e._v("弱电间管理系统")]),a("div",{staticClass:"header-right"},[a("el-submenu",{attrs:{index:"#"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-s-custom"}),e._v(e._s(e.realname)+"    ")]),a("el-menu-item",{attrs:{index:"#logout"},on:{click:e.logout}},[e._v("登出")])],2)],1)])],1),a("el-main",{style:e.defaultHeight},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:e.rooms,"max-height":"740"},on:{"filter-change":e.filterChange}},[a("el-table-column",{attrs:{prop:"campus_name",label:"校区",width:"110","column-key":"campusIds",filters:e.filters.campusIds}}),a("el-table-column",{attrs:{label:"楼号及名称",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.building_number)+" "+e._s(t.row.building_name)+" ")]}}])}),a("el-table-column",{attrs:{prop:"location",label:"具体位置",width:"120"}})],1)],1),a("el-footer",[a("el-row",[a("el-col",{attrs:{span:8}},[a("div",[a("el-button",{attrs:{icon:"el-icon-menu",circle:""},on:{click:e.display}}),a("div",[a("span",{staticStyle:{"font-size":"10px"}},[e._v("任务中心")])])],1)]),a("el-col",{attrs:{span:8}},[a("div",[a("el-button",{attrs:{icon:"el-icon-search",circle:""},on:{click:e.searchPosition}}),a("div",[a("span",{staticStyle:{"font-size":"10px"}},[e._v("查看地址")])])],1)]),a("el-col",{attrs:{span:8}},[a("div",[a("el-button",{attrs:{icon:"el-icon-user",circle:""},on:{click:e.personalCenter}}),a("div",[a("span",{staticStyle:{"font-size":"10px"}},[e._v("个人中心")])])],1)])],1)],1)],1)],1)},_e=[],ye={data:function(){return{defaultHeight:{height:""},user_id:localStorage.getItem("user_id"),realname:localStorage.getItem("realname"),loading:!0,exportVisible:!1,exportNum:null,exportUrl:null,search_content:"",totalPage:1,rooms:[],previewVisible:!1,previewImages:[],filters:{campusIds:[],typeIds:[],hasLock:[{text:"有",value:!0},{text:"无",value:!1}],hasAc:[{text:"有",value:!0},{text:"无",value:!1}],hasDevice:[{text:"移动设备",value:"has_mobile_device"},{text:"电信设备",value:"has_telecom_device"},{text:"联通设备",value:"has_unicom_device"}],hasEnv:[{text:"全部为A级",value:1},{text:"含B级以下",value:2},{text:"含C级以下",value:3}]},params:{page:1,per_page:30,campus_ids:null,type_ids:null,has_lock:null,has_ac:null,has_mobile_device:null,has_telecom_device:null,has_unicom_device:null,has_env:null}}},methods:{logout:function(){var e=this;this.$notify({title:"登出成功",message:"您已登出，请重新登录",type:"success",duration:1e3,onClose:function(){localStorage.clear(),e.$router.push("/")}})},getData:function(){var e=this;this.loading=!0,this.API.getRoomList(this.params).then((function(t){e.totalPage=t["total_page"],e.params.page>e.totalPage?e.params.page=e.totalPage:(e.rooms=t["results"],e.loading=!1)}))},filterChange:function(e){var t=this;this.params.page=1,void 0!==e.campusIds&&(this.params.campus_ids=e.campusIds.join(",")),void 0!==e.typeIds&&(this.params.type_ids=e.typeIds.join(",")),void 0!==e.hasLock&&(this.params.has_lock=e.hasLock[0]),void 0!==e.hasAc&&(this.params.has_ac=e.hasAc[0]),void 0!==e.hasDevice&&(this.params.has_mobile_device=null,this.params.has_telecom_device=null,this.params.has_unicom_device=null,e.hasDevice.forEach((function(e){t.params[e]=!0}))),void 0!==e.hasEnv&&(this.params.has_env=e.hasEnv[0]),1===this.params.page?this.getData():this.params.page=1},clearFilter:function(){this.$refs["table"].clearFilter(),this.params={page:1,per_page:30,campus_ids:null,type_ids:null,has_lock:null,has_ac:null,has_mobile_device:null,has_telecom_device:null,has_unicom_device:null,has_env:null},this.getData()},exportData:function(){var e=this;this.exportVisible=!0,this.exportUrl=null,this.API.exportRooms().then((function(t){e.exportUrl=e.axios.defaults.baseURL+"/static/"+t["filename"],e.exportNum=t["count"]}))},getHeight:function(){this.defaultHeight.height=window.innerHeight-120+"px"},handleClick:function(e,t){console.log(e,t)},display:function(){this.$router.push("/display")},searchPosition:function(){this.$router.push("/searchPosition")},personalCenter:function(){this.$router.push("/personalCenter/".concat(localStorage.user_id))}},mounted:function(){var e=this;this.getData(),this.API.getCampusList().then((function(t){e.filters.campusIds=[],t.forEach((function(t){e.filters.campusIds.push({text:t.name,value:t.id})}))})),this.API.getRoomTypes().then((function(t){e.filters.typeIds=[],t.forEach((function(t){1!==t.id&&e.filters.typeIds.push({text:t.name,value:t.id})}))}))},watch:{"params.page":function(){this.getData()}},created:function(){window.addEventListener("resize",this.getHeight()),this.getHeight()}},we=ye,xe=(a("f732"),Object(u["a"])(we,ve,_e,!1,null,null,null)),Ie=xe.exports,Se=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-container",[a("el-header",[a("el-menu",{staticClass:"menu",attrs:{mode:"horizontal",router:!0,"default-active":e.defaultActive}},[a("h4",[e._v("弱电间管理系统")]),a("div",{staticClass:"header-right"},[a("el-submenu",{attrs:{index:"#"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-s-custom"}),e._v(e._s(e.realname)+"    ")]),a("el-menu-item",{attrs:{index:"#logout"},on:{click:e.logout}},[e._v("登出")])],2)],1)])],1),a("el-main",{style:e.defaultHeight},[a("el-dialog",{attrs:{visible:e.confirmVisible,width:"60%"},on:{"update:visible":function(t){e.confirmVisible=t}}},[a("el-descriptions",{staticClass:"margin-top",attrs:{title:"信息确认",column:2,border:""}},[a("el-descriptions-item",[a("template",{slot:"label"},[e._v(" 姓名 ")]),e._v(" "+e._s(e.form.realname)+" ")],2),a("el-descriptions-item",[a("template",{slot:"label"},[e._v(" 用户名 ")]),e._v(" "+e._s(e.form.username)+" ")],2),a("el-descriptions-item",[a("template",{slot:"label"},[e._v(" 新密码 ")]),e._v(" "+e._s(""!=e.form.new_password?e.form.new_password:"未修改")+" ")],2)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.confirmVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{disabled:e.disabled,type:"primary"},on:{click:e.submitForm}},[e._v("确 定")])],1)],1),a("el-page-header",{attrs:{content:"个人中心"},on:{back:function(t){return e.$router.go(-1)}}}),a("el-divider"),a("div",{staticClass:"detail-main"},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"姓名",prop:"realname"}},[a("el-input",{staticClass:"w250",attrs:{placeholder:"请输入姓名"},model:{value:e.form.realname,callback:function(t){e.$set(e.form,"realname",t)},expression:"form.realname"}})],1),a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{staticClass:"w250",attrs:{placeholder:"请输入用户名"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),a("el-form-item",{attrs:{label:"新密码",prop:"new_password"}},[a("el-input",{staticClass:"w250",attrs:{type:"password",placeholder:"请输入新密码"},model:{value:e.form.new_password,callback:function(t){e.$set(e.form,"new_password",t)},expression:"form.new_password"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",disabled:e.disabled},on:{click:e.onSubmit}},[e._v("提交")]),a("el-button",{on:{click:function(t){return e.$router.go(-1)}}},[e._v("取消")])],1)],1)],1)],1),a("el-footer",[a("el-row",[a("el-col",{attrs:{span:8}},[a("div",[a("el-button",{attrs:{icon:"el-icon-menu",circle:""},on:{click:e.display}}),a("div",[a("span",{staticStyle:{"font-size":"10px"}},[e._v("任务中心")])])],1)]),a("el-col",{attrs:{span:8}},[a("div",[a("el-button",{attrs:{icon:"el-icon-search",circle:""},on:{click:e.searchPosition}}),a("div",[a("span",{staticStyle:{"font-size":"10px"}},[e._v("查看地址")])])],1)]),a("el-col",{attrs:{span:8}},[a("div",[a("el-button",{attrs:{icon:"el-icon-user",circle:""},on:{click:e.personalCenter}}),a("div",[a("span",{staticStyle:{"font-size":"10px"}},[e._v("个人中心")])])],1)])],1)],1)],1)],1)},$e=[],Pe=(a("ac1f"),a("00b4"),{data:function(){var e=function(e,t,a){var i=/^(?=.*\d)(?=.*[a-z])[a-zA-Z0-9~!@#$%^&*]{8,16}$/;t?(i.test(t)||a(new Error("密码必须包含数字和字母, 且长度为8-16位")),a()):a()};return{defaultHeight:{height:""},user_id:localStorage.getItem("user_id"),realname:localStorage.getItem("realname"),loading:!0,disabled:!1,confirmVisible:!1,rules:{realname:[{required:!0,message:"请输入姓名",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],new_password:[{validator:e,trigger:"blur"}],character:[{required:!0,message:"请选择角色",trigger:"change"}]},charas:{0:"超级管理员",1:"管理员",2:"工作人员"},campus:[],form:{realname:"",username:"",new_password:"",character:null,campus:[]}}},methods:{onSubmit:function(){var e=this;this.$refs["form"].validate((function(t){if(!t)return!1;e.confirmVisible=!0}))},submitForm:function(){var e=this;this.disabled=!0,this.API.updateUser(this.$router.currentRoute.params.id,{realname:this.form.realname,username:this.form.username,password:this.form.new_password,character:this.form.character,campus:this.form.campus.map((function(e){return e.id}))}).then((function(){e.$notify({title:"成功",message:"修改成功",type:"success",duration:1e3,onClose:function(){e.disabled=!1,e.$router.push("/display")}})})).catch((function(){e.disabled=!1,e.confirmVisible=!1}))},logout:function(){var e=this;this.$notify({title:"登出成功",message:"您已登出，请重新登录",type:"success",duration:1e3,onClose:function(){localStorage.clear(),e.$router.push("/")}})},getHeight:function(){this.defaultHeight.height=window.innerHeight-120+"px"},handleClick:function(e,t){console.log(e,t)},display:function(){this.$router.push("/display")},searchPosition:function(){this.$router.push("/searchPosition")},personalCenter:function(){this.$router.push("/personalCenter/".concat(localStorage.user_id))}},mounted:function(){var e=this;this.axios.all([this.API.getUserDetail(this.$router.currentRoute.params.id),this.API.getCampusList()]).then(this.axios.spread((function(t,a){a.forEach((function(t){null!==t.executive_id&&t.executive_id!==parseInt(e.$router.currentRoute.params.id)||e.campus.push(t)})),e.form=t,e.loading=!1})))},created:function(){window.addEventListener("resize",this.getHeight()),this.getHeight()}}),Te=Pe,De=(a("7170"),Object(u["a"])(Te,Se,$e,!1,null,null,null)),Ce=De.exports,Ee={data:function(){return{originImages:[],beforeImages:[],afterImages:[]}},mounted:function(){var e=this;this.API.getMissionDetail(this.$router.currentRoute.params.id).then((function(t){t.before_images.forEach((function(t){e.beforeImages.push(e.STATIC_URL+t)})),t.after_images.forEach((function(t){e.afterImages.push(e.STATIC_URL+t)}))}))}},ke=Ee,Me=(a("6fac"),a("916d")),Ae=a.n(Me),Le=Object(u["a"])(ke,ee,te,!1,null,null,null);"function"===typeof Ae.a&&Ae()(Le);var je=Le.exports;r["default"].use(f["a"]);var Re=new f["a"]({mode:"hash",routes:[{path:"/",name:"Main",component:y},{path:"/display",name:"Display",component:F},{path:"/submit/:id",name:"Submit",component:be},{path:"/missionRecord",name:"MissionRecord",component:pe},{path:"/roomDetail",name:"RoomDetail",component:oe},{path:"/levelTag",name:"LevelTag",component:ae},{path:"/personalCenter/:id",name:"PersonalCenter",component:Ce},{path:"/searchPosition",name:"SearchPosition",component:Ie},{path:"/missionHistory",name:"MissionHistory",component:B},{path:"/missionCurrent",name:"MissionCurrent",component:D},{path:"/missionPresave",name:"MissionPresave",component:L},{path:"/missionImages",name:"MissionImages",component:je}]}),Oe=(a("0fb7"),a("450d"),a("f529")),Ue=a.n(Oe),ze=(a("46a1"),a("e5f2")),Be=a.n(ze),Ge=(a("9e1f"),a("6ed5")),He=a.n(Ge),Ve=(a("be4f"),a("896a")),Fe=a.n(Ve),Ne=(a("672e"),a("101e")),qe=a.n(Ne),Je=(a("e612"),a("dd87")),Xe=a.n(Je),Ze=(a("075a"),a("72aa")),Ke=a.n(Ze),Qe=(a("e960"),a("b35b")),We=a.n(Qe),Ye=(a("fe07"),a("6ac5")),et=a.n(Ye),tt=(a("b5d8"),a("f494")),at=a.n(tt),it=(a("06f1"),a("6ac9")),nt=a.n(it),st=(a("e3ea"),a("7bc3")),ot=a.n(st),rt=(a("4fdb"),a("b076")),lt=a.n(rt),ct=(a("cbb5"),a("8bbc")),ut=a.n(ct),mt=(a("5466"),a("ecdf")),dt=a.n(mt),pt=(a("38a0"),a("ad41")),ft=a.n(pt),ht=(a("f4f9"),a("c2cc")),gt=a.n(ht),bt=(a("7a0f"),a("0f6c")),vt=a.n(bt),_t=(a("acb6"),a("c673")),yt=a.n(_t),wt=(a("186a"),a("301f")),xt=a.n(wt),It=(a("96dc"),a("9cea")),St=a.n(It),$t=(a("f225"),a("89a9")),Pt=a.n($t),Tt=(a("d4df"),a("7fc1")),Dt=a.n(Tt),Ct=(a("560b"),a("dcdc")),Et=a.n(Ct),kt=(a("826b"),a("c263")),Mt=a.n(kt),At=(a("6611"),a("e772")),Lt=a.n(At),jt=(a("1f1a"),a("4e4b")),Rt=a.n(jt),Ot=(a("b8e0"),a("a4c4")),Ut=a.n(Ot),zt=(a("f92a"),a("d775")),Bt=a.n(zt),Gt=(a("d96c"),a("0c9b")),Ht=a.n(Gt),Vt=(a("fb08"),a("21e5")),Ft=a.n(Vt),Nt=(a("a7cc"),a("df33")),qt=a.n(Nt),Jt=(a("6dca"),a("2cf9")),Xt=a.n(Jt),Zt=(a("aaa5"),a("a578")),Kt=a.n(Zt),Qt=(a("5e32"),a("6721")),Wt=a.n(Qt),Yt=(a("a769"),a("5cc3")),ea=a.n(Yt),ta=(a("1951"),a("eedf")),aa=a.n(ta),ia=(a("10cb"),a("f3ad")),na=a.n(ia),sa=(a("eca7"),a("3787")),oa=a.n(sa),ra=(a("425f"),a("4105")),la=a.n(ra),ca=(a("de31"),a("c69e")),ua=a.n(ca),ma=(a("ce18"),a("f58e")),da=a.n(ma),pa=(a("8bd8"),a("4cb2")),fa=a.n(pa),ha=(a("4ca3"),a("443e")),ga=a.n(ha),ba=(a("a673"),a("7b31")),va=a.n(ba),_a=(a("adec"),a("3d2d")),ya=a.n(_a),wa=[ya.a,va.a,ga.a,fa.a,da.a,ua.a,la.a,oa.a,na.a,aa.a,ea.a,Wt.a,Kt.a,Xt.a,qt.a,Ft.a,Ht.a,Bt.a,Ut.a,Rt.a,Lt.a,Mt.a,Et.a,Dt.a,Pt.a,St.a,xt.a,yt.a,vt.a,gt.a,ft.a,dt.a,ut.a,lt.a,ot.a,nt.a,at.a,et.a,We.a,Ke.a,Xe.a,qe.a];wa.forEach((function(e){r["default"].use(e)})),r["default"].use(Fe.a.directive),r["default"].prototype.$msgbox=He.a,r["default"].prototype.$alert=He.a.alert,r["default"].prototype.$confirm=He.a.confirm,r["default"].prototype.$prompt=He.a.prompt,r["default"].prototype.$notify=Be.a,r["default"].prototype.$message=Ue.a;var xa=a("bc3a"),Ia=a.n(xa),Sa=a("130e");Ia.a.defaults.baseURL="https://lvroom.terrace.ink/api",Ia.a.interceptors.request.use((function(e){return e.headers["Authorization"]="Bearer "+localStorage.getItem("token"),e}),(function(e){return Promise.reject(e)})),Ia.a.interceptors.response.use((function(e){return e}),(function(e){if(e.response){var t=e.response.data.detail;console.log(t),Be()({type:"error",title:"操作失败",message:t,duration:3e3,onClose:function(){401==e.response.status&&(localStorage.clear(),window.location.href="/login")}})}else console.log(e),Be()({type:"error",title:"网络错误",message:"发送请求时出现网络错误, 请检查网络"});return Promise.reject(e)})),r["default"].use(Sa["a"],Ia.a),r["default"].prototype.$isAdmin=function(){var e=parseInt(localStorage.getItem("character"));return!isNaN(e)&&e<=1},r["default"].prototype.$isSU=function(){var e=parseInt(localStorage.getItem("character"));return!isNaN(e)&&0==e};a("99af");var $a={},Pa={},Ta={},Da={};function Ca(e,t,a){return new Promise((function(i,n){var s={method:e,url:t};"POST"===e||"PUT"===e?s.data=a:void 0!==a&&(s.params={},Object.keys(a).forEach((function(e){null!==a[e]&&void 0!==a[e]&&(s.params[e]=a[e])}))),Ia()(s).then((function(e){void 0!==e.data.data?i(e.data.data):i(null)})).catch((function(e){n(e)}))}))}function Ea(e,t,a){return new Promise((function(i,n){void 0===Pa[t]||Pa[t]<Date.now()-3e5?(Pa[t]=Date.now(),Ta[t]=[i],Da[t]=[n],Ca(e,t,a).then((function(e){$a[t]=e,Ta[t].forEach((function(t){return t(e)})),Ta[t]=[],Da[t]=[]})).catch((function(e){Da[t].forEach((function(t){return t(e)})),Ta[t]=[],Da[t]=[]}))):void 0===$a[t]?(Ta[t].push(i),Da[t].push(n)):i($a[t])}))}var ka={login:function(e,t){return Ca("POST","/auth/login",{username:e,password:t})},getRoomList:function(e){return Ca("GET","/rooms",e)},createRoom:function(e){return Ca("POST","/room",e)},updateRoom:function(e,t){return Ca("PUT","/room/".concat(e),t)},deleteRoom:function(e){return Ca("DELETE","/room/".concat(e))},getRoomMedia:function(e){return Ca("GET","/room/".concat(e,"/media"))},getRoomDetail:function(e){return Ca("GET","/room/".concat(e))},getRoomRecordList:function(e){return Ca("GET","/room/".concat(e,"/records"))},getRoomTree:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Ca("GET","/rooms/tree?exclude_other=".concat(e))},exportRoomDocument:function(){return Ca("GET","/rooms/document/export")},exportRoomHistory:function(){return Ca("GET","/rooms/history/export")},getCampusList:function(){return Ea("GET","/campus")},getBuildingsInCampus:function(e){return Ca("GET","/campus/".concat(e,"/buildings"))},getRoomsInBuilding:function(e){return Ca("GET","/building/".concat(e,"/rooms"))},getRoomTypes:function(){return Ea("GET","/types/room")},getMissionTypes:function(){return Ea("GET","/types/mission")},uploadImage:function(e){var t=new FormData;return t.append("file",e),new Promise((function(e,a){Ia()({method:"POST",url:"/upload",data:t,headers:{"Content-Type":"multipart/form-data"}}).then((function(t){void 0!==t.data.data?e(t.data.data):e(null)})).catch((function(e){a(e)}))}))},getUserList:function(){return Ea("GET","/users")},getUserDetail:function(e){return Ca("GET","/user/".concat(e))},createUser:function(e){return Ca("POST","/user",e)},updateUser:function(e,t){return Ca("PUT","/user/".concat(e),t)},deleteUser:function(e){return Ca("DELETE","/user/".concat(e))},createMission:function(e){return Ca("POST","/mission",e)},deleteMission:function(e){return Ca("DELETE","/mission/".concat(e))},deleteMultiMissions:function(e){return Ca("DELETE","/missions",{mission_ids:e.join(",")})},restartMission:function(e){return Ca("GET","/mission/".concat(e,"/restart"))},restartMultiMissions:function(e){return Ca("GET","/missions/restart",{mission_ids:e.join(",")})},cancelMission:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Ca("GET","/mission/".concat(e,"/cancel"),{description:t})},cancelMultiMissions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Ca("GET","/missions/cancel",{mission_ids:e.join(","),description:t})},getMissionList:function(e){return Ca("GET","/missions",e)},getMissionDetail:function(e){return Ca("GET","/mission/".concat(e))},submitMission:function(e,t,a){return Ca("POST","/mission/".concat(e,"/submit?presave=").concat(t),a)},getMissionRecord:function(e){return Ca("GET","/mission/".concat(e,"/record"))},exportMissions:function(e,t){return Ca("GET","/missions/export",{from_date:e,end_date:t})},getProblemList:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30;return Ca("GET","/problems",{solved:e,page:t,per_page:a})},solveProblem:function(e){return Ca("GET","/problem/".concat(e,"/solve"))},reopenProblem:function(e){return Ca("GET","/problem/".concat(e,"/reopen"))},getDeviceInRoom:function(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;return Ca("GET","/room/".concat(e,"/devices"),{status:t,page:a,per_page:i})},createDevice:function(e,t){return Ca("POST","/room/".concat(e,"/device"),t)},getDeviceDetail:function(e){return Ca("GET","/device/".concat(e))},updateDevice:function(e,t){return Ca("PUT","/device/".concat(e),t)},deleteDevice:function(e){return Ca("DELETE","/device/".concat(e))},downDevice:function(e,t){return Ca("POST","/device/".concat(e,"/down"),t)}};r["default"].config.productionTip=!1,r["default"].prototype.API=ka,r["default"].use(o.a),new r["default"]({el:"#app",router:Re,render:function(e){return e(p)}}).$mount("#app")},"60be":function(e,t,a){},"6cb2":function(e,t,a){"use strict";a("a1c4")},"6fac":function(e,t,a){"use strict";a("b313")},7170:function(e,t,a){"use strict";a("454e")},7374:function(e,t,a){},"85ec":function(e,t,a){},8818:function(e,t,a){"use strict";a("4e25")},"916d":function(e,t){},9269:function(e,t,a){"use strict";a("9e89")},9736:function(e,t,a){"use strict";a("60be")},"9bba":function(e,t,a){},"9e89":function(e,t,a){},a1c4:function(e,t,a){},b313:function(e,t,a){},bbf1:function(e,t,a){"use strict";a("0abd")},bcf1:function(e,t,a){},d662:function(e,t,a){"use strict";a("9bba")},f732:function(e,t,a){"use strict";a("7374")}});
//# sourceMappingURL=app.57c029d2.js.map